# Fly.io configuration for catty-api
#
# This app provides the API for creating and managing catty sessions.
#
# One-time setup:
#   fly apps create catty-api
#   fly secrets set FLY_API_TOKEN=<your-token> -a catty-api
#   fly secrets set ANTHROPIC_API_KEY=<your-key> -a catty-api
#   fly deploy -c fly.api.toml

app = "catty-api"
primary_region = "iad"

[build]
  dockerfile = "Dockerfile.api"

[env]
  # Use Fly's internal Machines API when running on Fly
  FLY_MACHINES_API_BASE = "http://_api.internal:4280"
  CATTY_EXEC_APP = "catty-exec"
  CATTY_API_ADDR = "0.0.0.0:8080"

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = "stop"
  auto_start_machines = true
  min_machines_running = 1

[http_service.concurrency]
  type = "requests"
  hard_limit = 250
  soft_limit = 200
